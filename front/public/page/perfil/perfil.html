<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil</title>
  <link rel="stylesheet" href="../../assets/css/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>

<style>
  html,
  body {
    overflow: hidden !important;
    height: 100% !important;
    width: 100% !important;
    overscroll-behavior: none;
    touch-action: none;
    position: fixed;
  }

  body {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  body::-webkit-scrollbar {
    display: none;
  }
</style>

<body>
  <div class="P-esconder">
    <div>
      <div class="enfeite"></div>
      <div class="Pdiv">
        <div class="fotoperfil">
          <img src="../../assets/img/FotoP.png" alt="Foto de Perfil" class="fotoP" />
          <div class="icone-editar">
            <i class="bi bi-pen-fill"></i>
          </div>
        </div>

        <!-- <h1 class="tituloP">User</h1> -->

        <div class="infomarcoes">
          <div class="campo">
            <div>
              <label>ID</label>
              <div class="elementos-perfil">
                <span id="userId">carregado...</span>
              </div>
            </div>
          </div>

          <div class="campo">
            <div>
              <label>E-mail</label>
              <div class="elementos-perfil">
                <span id="userEmail">carregado...</span>
                <i class="bi bi-pen-fill btn-perfil-alteracoes"></i>
              </div>
            </div>
          </div>

          <div class="campo">
            <div>
              <label>Nome</label>
              <div class="elementos-perfil">
                <span id="userNome">carregado...</span>
                <i class="bi bi-pen-fill btn-perfil-alteracoes"></i>
              </div>
            </div>
          </div>

          <div class="campo">
            <div>
              <label>Telefone</label>
              <div class="elementos-perfil">
                <span id="userTelefone">carregado...</span>
                <i class="bi bi-pen-fill btn-perfil-alteracoes"></i>
              </div>
            </div>
          </div>

          <div class="logout" id="logoutBtn">
            <label style="cursor: pointer;">Logout</label>
            <i class="bi bi-box-arrow-right iconLogout"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

<script type="module">
  import { openModal, closeModal } from '../../components/reutilizaveis/modal-input/modal.js';

  // 1. Captura e valida o usuário
  const user = JSON.parse(localStorage.getItem('user') || '{}');
  const token = localStorage.getItem('token');

  if (!user.id || !token) {
    window.location.href = '/login';
  }

  // 2. Preenche os dados
  document.getElementById('userId').textContent = user.id || 'Não informado';
  document.getElementById('userEmail').textContent = user.email || 'Não informado';
  document.getElementById('userNome').textContent = user.nome || 'Não informado';
  document.getElementById('userTelefone').textContent = user.telefone || 'Não informado';

  // 3. Garante que não haja outros eventos no botão
  const oldBtn = document.getElementById('logoutBtn');
  const logoutBtn = oldBtn.cloneNode(true);
  oldBtn.parentNode.replaceChild(logoutBtn, oldBtn);

  // 4. Aplica o novo comportamento de logout com modal
  // logoutBtn.addEventListener('click', (e) => {
  //   e.preventDefault();
  //   e.stopPropagation();

  //   // Abre o modal de confirmação
  //   openModal('Sair da conta', `
  //     <p>Tem certeza que deseja sair da sua conta?</p>
  //     <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
  //       <button id="confirmLogoutBtn" class="btn btn-danger">Sim, sair</button>
  //       <button id="cancelLogoutBtn" class="btn btn-secondary">Cancelar</button>
  //     </div>
  //   `);

  //   // Aguarda o modal ser injetado no DOM antes de capturar os botões
  //   setTimeout(() => {
  //     const confirmBtn = document.getElementById('confirmLogoutBtn');
  //     const cancelBtn = document.getElementById('cancelLogoutBtn');

  //     if (confirmBtn) {
  //       confirmBtn.addEventListener('click', () => {
  //         // Executa o logout
  //         localStorage.removeItem('token');
  //         localStorage.removeItem('user');
  //         closeModal();

  //         // Feedback visual
  //         openModal('Logout realizado', `<p>Você saiu da sua conta com sucesso.</p>`);
  //         setTimeout(() => {
  //           window.location.href = '/login';
  //         }, 1200);
  //       });
  //     }

  //     if (cancelBtn) {
  //       cancelBtn.addEventListener('click', closeModal);
  //     }
  //   }, 200);
  // });
</script>

</html>